---
title: ä¿åºå›å½’å­¦ä¹ ç¬”è®°
date: 2020-09-29 16:24:13
tags:
- æ•´ä½“äºŒåˆ†
- ä¿åºå›å½’
---

[é¢˜ç›®é“¾æ¥](https://www.luogu.com.cn/problem/P5294)ï¼Œå‚è€ƒèµ„æ–™ï¼šè®ºæ–‡é›†2018ã€Šæµ…è°ˆä¿åºå›å½’é—®é¢˜ã€‹é«˜ç¿æ³‰

<!--more-->

# ä¿åºå›å½’é—®é¢˜çš„å®šä¹‰

$L_p$ é—®é¢˜çš„å®šä¹‰å¦‚ä¸‹ï¼š

> ç»™å‡ºä¸€å¼  DAG $G=(V,E)$ï¼Œæ¯ä¸ªç‚¹ $i$ æœ‰ä»£ä»· $y_i,w_i$ï¼ˆ$w_i>0$ï¼‰ã€‚æ±‚ç‚¹å€¼åºåˆ— $f$ï¼Œæ»¡è¶³å¦‚æœåœ¨ $G$ ä¸­æœ‰ä» $i$ åˆ° $j$ çš„è·¯å¾„ï¼ˆç§°ä¸º $v_i\preceq v_j$ï¼‰ï¼Œåˆ™å¿…é¡»æœ‰ $f_i\le f_j$ï¼Œå¹¶ä½¿å¾—å›å½’ä»£ä»·
>
> $$
> \begin{cases}\sum_{i=1}^nw_i|f_i-y_i|^p&(1\le p<\infty)\\\max_{i=1}^n w_i|f_i-y_i|&(p=\infty)\end{cases}
> $$
>
> æœ€å°ã€‚

# å…¶ä»–å®šä¹‰

> å°†åºåˆ— $z$ ä¸­ $\le a$ çš„å…ƒç´ å˜ä¸º $a$ï¼Œ$\ge b$ çš„å…ƒç´ å˜ä¸º $b$ï¼Œç§°ä¸º**æŠŠ $z$ å‘ $(a,b)$ å–æ•´**ã€‚

> **ç‚¹é›† $U$ çš„ $L_p$ å‡å€¼**ä¸ºä½¿å¾—
> $$
> \begin{cases}\sum_{i\in U}w_i|k-y_i|^p&(1\le p<\infty)\\\max_{i\in U} w_i|k-y_i|&(p=\infty)\end{cases}
> $$
> æœ€å°çš„ $k$ã€‚

> å®šä¹‰ $\bold S$ **é—®é¢˜**ä¸ºï¼Œåœ¨æ»¡è¶³ $L_p$ æ‰€æœ‰é™åˆ¶çš„åŒæ—¶ï¼Œè¿˜è¦æ±‚ $a\le f_i\le b\ \ (a<b)$ï¼Œæ±‚æœ€å°å›å½’ã€‚

# å¯¹ $p=1$ æƒ…å†µçš„è§£æ³•â€”â€”æ•´ä½“äºŒåˆ†

## å‡†å¤‡å·¥ä½œ

> **å¼•ç† 1.** å½“ $1<p<\infty$ æ—¶ï¼Œä»»æ„é›†åˆ $U$ çš„ $L_p$ å‡å€¼å”¯ä¸€ï¼›å½“ $p=1$ æ—¶ï¼Œä»»æ„é›†åˆ $U$ çš„ $L_p$ å‡å€¼æ„æˆä¸€ä¸ªåŒºé—´ã€‚
>
> **å¼•ç† 2.** ä»»æ„é›†åˆçš„ $L_p(1\le p<\infty)$ å‡å€¼ä¸å°äºè¯¥é›†åˆçš„æœ€å°å€¼ï¼Œä¸å¤§äºè¯¥é›†åˆçš„æœ€å¤§å€¼ã€‚

**è¯æ˜**ï¼šè®¾
$$
g_U(k)=\sum_{y_i\le k,i\in U}w_i(k-y_i)^p+\sum_{y_i>k,i\in U}w_i(y_i-k)^p
$$
åˆ™æœ‰
$$
g'_U(k)=\sum_{y_i\le k,i\in U}pw_i(k-y_i)^{p-1}-\sum_{y_i>k,i\in U}pw_i(y_i-k)^{p-1}
$$
å®¹æ˜“å‘ç° $g'_U(k)$ å½“ $p>1$ æ—¶å•è°ƒå¢ï¼Œå½“ $p=1$ æ—¶ä¹Ÿå•è°ƒä¸é™ã€‚è€Œå½“ $k<\min y$ æ—¶æ˜¾ç„¶æœ‰ $g'_U(k)<0$ï¼Œå½“ $k>\max y$ æ—¶æ˜¾ç„¶æœ‰ $g'_U(k)>0$ï¼Œä»è€Œå¾—è¯ã€‚$\square$

## é‡è¦å®šç†

> **å®šç† 1.** åœ¨ $L_1$ é—®é¢˜ä¸­ï¼Œå¦‚æœï¼š
>
> - ä»»æ„ $y_i$ å‡ä¸åœ¨åŒºé—´ $(a,b)$ å†…
> - å­˜åœ¨ä¸€ä¸ªæœ€ä¼˜è§£åºåˆ— $z_i$ çš„å…ƒç´ ä¹Ÿå‡ä¸åœ¨ $(a,b)$ å†…
> 
> è®° $z^S$ æ˜¯ $S$ é—®é¢˜çš„ä¸€ä¸ªæœ€ä¼˜è§£ï¼Œé‚£ä¹ˆä¸€å®šå­˜åœ¨ $L_1$  çš„ä¸€ä¸ªæœ€ä¼˜è§£ $z$ï¼Œä½¿å¾— $z$ å‘ $(a,b)$ å–æ•´å¯ä»¥å¾—åˆ° $z^S$ã€‚

è¿™ä¸ªå¼•ç†å¹¶æ²¡æœ‰å®ƒçœ‹èµ·æ¥é‚£ä¹ˆè‡ªç„¶ã€‚

**è¯æ˜**ï¼šåè¯æ³•ã€‚

å‡è®¾ä¸å­˜åœ¨èƒ½å–æ•´åˆ° $z^S$ çš„ $L_1$ æœ€ä¼˜è§£ï¼Œè®° $z$ æ˜¯ä¸€ä¸ªå…ƒç´ ä¸åœ¨ $(a,b)$ å†…ä¸”ä¸èƒ½å–æ•´åˆ° $z_S$ çš„æœ€ä¼˜è§£ã€‚

ä¸‹é¢æˆ‘ä»¬è¯æ˜ä¸€ä¸ªå¼•ç†

> **å¼•ç† 3.** $\forall i,z_i^S=a\or z_i^S=b$ã€‚

**è¯æ˜ï¼š**æ³¨æ„ $g'$ ä¸åœ¨ $(a,b)$ ä¸Šæœ‰é›¶ç‚¹ï¼Œä»è€Œæ­£è´Ÿæ€§æ’å®šã€‚åè¯æ³•ï¼Œå‡è®¾å­˜åœ¨ $z_i^S\neq a\and z_i^S\neq b$ã€‚

è€ƒè™‘ $z_i^S\neq b$ ä¸­å–åˆ°æœ€å¤§å€¼çš„ç‚¹é›†ï¼Œè®°ä¸º $U$ã€‚æ˜¾ç„¶ $U$ ä¸å—åˆ°æ¥è‡ªå¤–éƒ¨çš„ $\le $ é™åˆ¶ã€‚å¦‚æœ $g'_U\le 0$ï¼Œåˆ™æ˜¾ç„¶å¯ä»¥æŠŠ $U$ å…¨éƒ¨è°ƒæ•´åˆ° $b$ã€‚å¦åˆ™ä¼šå¼•å‡ºçŸ›ç›¾ï¼Œæˆ‘ä»¬æŠŠ $U$ è°ƒæ•´åˆ°å‰©ä¸‹çš„ç‚¹é›†ä¸­çš„æœ€å°å€¼ä¼šä½¿å¾—å›å½’ä»£ä»·æ›´å°ï¼Œä»è€Œ $z^S$ å¹¶éæœ€ä¼˜è§£ã€‚$\square$

äºæ˜¯å¿…å®šå­˜åœ¨ $z_i$ï¼Œæœ‰ $z_i^S=b,z_i\le a$ æˆ– $z^S_i=a,z_i\ge b$ã€‚

æ˜¾ç„¶è¿™ä¸¤ç±»ç‚¹ä¹‹é—´æ²¡æœ‰ååºå…³ç³»ï¼Œäºæ˜¯å¯ä»¥åˆ†å¼€ç ”ç©¶ï¼Œä»è€Œæˆ‘ä»¬æ¥ä¸‹æ¥å¯ä»¥ä¸å¤±ä¸€èˆ¬æ€§åœ°åªè¯æ˜

> ä¸å­˜åœ¨è¿™æ ·çš„ $z$ï¼Œä½¿å¾—å­˜åœ¨ $z_i^S=b,z_i\le a$ è€Œä¸” $z$ æ˜¯æœ€ä¼˜è§£ã€‚

è®°è¿™ç±»ç‚¹ä¸º**åç‚¹**ã€‚

è®¾**åç‚¹ä¸­ $z$ å–åˆ°æœ€å¤§å€¼**çš„é‚£äº›ç‚¹æ„æˆçš„ç‚¹é›†ä¸º $U$ã€‚æ ¹æ®**å¼•ç† 1**ï¼Œ$U$ çš„ $L_1$ å‡å€¼æ˜¯ä¸€ä¸ªåŒºé—´ï¼Œè®°ä¸º $[l,r]$ã€‚æ˜¾ç„¶ï¼Œ$U$ çš„ $g$ å‡½æ•°åœ¨ $(-\infty,l)$ å•è°ƒé™ï¼Œåœ¨ $(r,+\infty)$ å•è°ƒå¢ã€‚

ï¼ˆè¯·æ³¨æ„ï¼Œå½“æˆ‘ä»¬è°ˆè®º***ä»»ä½•å…¶ä»–é›†åˆ***ï¼Œè¿™ä¸ªç»“è®ºéƒ½æ˜¯***ä¸æˆç«‹çš„***ã€‚è€Œä¸”ï¼Œç”±äºæˆ‘ä»¬è¯´çš„æ˜¯ $g$ å‡½æ•°å•è°ƒé™ï¼Œä»è€Œå¦‚æœå¸Œæœ›è°ƒæ•´ $U$ çš„å›å½’ä»£ä»·å°±å¿…é¡»ä½¿ $U$ çš„***æ‰€æœ‰å…ƒç´ ä¸€èµ·è°ƒæ•´***ã€‚ï¼‰

ï¼ˆè¯·æ³¨æ„ï¼Œæˆ‘ä»¬ç”šè‡³ä¸èƒ½ä¿è¯ $z_U\in [l,r]$ã€‚å…¶ä¸­ $z_U$ æ˜¯ $U$  ä¸­å…ƒç´ å…¬ç”¨çš„ $z$ å€¼ã€‚ï¼‰

æ³¨æ„ç”±äº $U$ å·²ç»åœ¨åç‚¹ä¸­ $z$ å–åˆ°äº†æœ€å¤§å€¼ï¼Œè€Œä¸” $z_i^S=b$ï¼Œæ‰€ä»¥ $U$ ä¸å—åˆ°ä»»ä½•æ¥è‡ªå¤–éƒ¨çš„ $\le$ é™åˆ¶ã€‚

- è‹¥ $l>a$ï¼Œåˆ™æˆ‘ä»¬å¢å¤§ $U$ ä¸­çš„æ‰€æœ‰ $z$ï¼Œå½“å®ƒä»¬å¢å¤§åˆ° $l$ å‰ï¼ˆå®ƒä»¬çš„ç¡®å¯ä»¥å¢å¤§ï¼‰å›å½’ä»£ä»·ä¸€ç›´éƒ½æ˜¯å•è°ƒé™çš„ï¼Œä»è€Œ $z$ å¹¶éæœ€ä¼˜è§£ï¼Œå¾—å‡ºçŸ›ç›¾ã€‚

- è‹¥ $l\le a,b\le r$ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥æŠŠ $U$ ä¸­çš„æ‰€æœ‰ $z$ å¢å¤§åˆ° $b$ï¼ˆå®ƒä»¬çš„ç¡®å¯ä»¥å¢å¤§ï¼‰ï¼Œæ˜¾ç„¶è¿™ç»„æ–°çš„è§£ä¸æ¯”åŸå…ˆçš„è§£åŠ£ï¼Œä½†æ˜¯å–æ•´æˆåŠŸçš„ç‚¹å˜å¤šäº†ï¼Œä»è€Œç»è¿‡æœ‰é™æ¬¡æ“ä½œå¯ä»¥å¾—åˆ°ä¸€ä¸ªèƒ½å–æ•´åˆ° $z^S$ çš„ $L_1$ æœ€ä¼˜è§£ï¼Œå¾—å‡ºçŸ›ç›¾ã€‚

- è‹¥ $l\le a,b>r$ã€‚æ­¤æ—¶å¢å¤§ $z_U$ æ²¡æœ‰ä»»ä½•ç›Šå¤„ï¼Œæˆ‘ä»¬éœ€è¦å¦å¯»æ–¹æ³•å¾—å‡ºçŸ›ç›¾ã€‚è®° $V$ ä¸ºåç‚¹é›†åˆã€‚

- - å¦‚æœ $U=V$ï¼Œä»è€Œæ˜¾ç„¶å¯ä»¥æŠŠ $z^S_i,i\in V$ ä» $b$ ä¸‹é™ï¼Œä½¿å¾—å›å½’ä»£ä»·é™ä½ï¼Œä»è€Œ $z^S$ å¹¶é $S$ é—®é¢˜çš„æœ€ä¼˜è§£ï¼Œå¾—å‡ºçŸ›ç›¾ã€‚
- å¦åˆ™æˆ‘ä»¬è®¾ $W$ æ˜¯åœ¨ $V/U$ ä¸­ $z$ å–åˆ°æœ€å¤§å€¼çš„ç‚¹é›†ã€‚è®° $W$ çš„ $L_1$ å‡å€¼ä¸º $[l',r']$ã€‚æˆ‘ä»¬ä¸èƒ½åƒä¸Šé¢ä¸€æ ·ä¸‹é™ $U$ï¼Œå› ä¸ºå¯èƒ½ä¼šè¢« $W$â€œå¡ä½â€ã€‚
  - - è‹¥ $r'<b$ï¼Œåˆ™æˆ‘ä»¬ä¸€å®šå¯ä»¥ä¸‹é™ $z_i^S,i\in W$ï¼Œä»è€Œ $z^S$ å¹¶é $S$ é—®é¢˜çš„æœ€ä¼˜è§£ï¼Œå¾—å‡ºçŸ›ç›¾ã€‚
  - - å¦åˆ™æœ‰ $r'\ge b>a\ge z_U$ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥æŠŠ $z_W$ è°ƒæ•´åˆ° $z_U$ å¾—åˆ°ä¸€ç»„ä¸æ›´åŠ£çš„è§£ï¼Œæ˜¾ç„¶é‡å¤è¯¥æ“ä½œæœ‰é™æ­¥å¿…å®šèƒ½å¾—å‡ºçŸ›ç›¾ã€‚$\square$

## è§£æ³•

æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå¼•ç†

> **å¼•ç† 4.** å¯¹äº $L_1$ é—®é¢˜ï¼Œå¿…å®šå­˜åœ¨ä¸€ä¸ªæœ€ä¼˜è§£ $z$ï¼Œä½¿å¾— $\forall z_i\in\{y\}$ã€‚

**è¯æ˜ï¼š**å‡ ä¹é‡å¤**å¼•ç† 3** çš„è¯æ˜è¿‡ç¨‹å³å¯ã€‚$\square$

ä»è€Œï¼Œé‡‡ç”¨**æ•´ä½“äºŒåˆ†**çš„æ€è·¯ï¼šå‡è®¾å½“å‰ç‚¹é›†çš„å–å€¼å·²ç»ç¡®å®šä¸º $y[l,r]$ï¼Œåˆ™è€ƒè™‘è®¡ç®— $S\{y_{mid},y_{mid+1}\}$ï¼Œå³å¯åº”ç”¨**å®šç† 1**ï¼ŒæŠŠå½“å‰ç‚¹é›†åˆ’åˆ†ä¸ºå–å€¼äº $y[l,mid]$ æˆ–å–å€¼äº $y[mid+1,r]$ã€‚

# $1<p<\infty$ çš„æƒ…å†µâ€”â€”åŒ–å½’åˆ° $p=1$

## é‡è¦å®šç†

> **å®šç† 2.** åœ¨ $L_p(1<p<\infty)$ é—®é¢˜ä¸­ï¼Œå¦‚æœï¼š
>
> - ä»»æ„ç‚¹é›†çš„ $L_p$ å‡å€¼å‡ä¸åœ¨ $(a,b)$ å†…
> - å­˜åœ¨ä¸€ä¸ªæœ€ä¼˜è§£åºåˆ— $z_i$ çš„å…ƒç´ ä¹Ÿå‡ä¸åœ¨ $(a,b)$ å†…
>
> è®° $\tilde z$ æ˜¯ç›¸åŒ DAG ä¸Šçš„ï¼Œå›å½’ä»£ä»·ä¸º
> $$
> (\tilde y_i,\tilde w_i)=\begin{cases}(0,w_i\Big((b-y_i)^p-(a-y_i)^p\Big))&(y_i\le a)\\(1,w_i\Big((y_i-b)^p-(y_i-a)^p\Big))&(y_i>a)\end{cases}
> $$
> çš„ $L_1$ é—®é¢˜çš„ä¸€ç»„æœ€ä¼˜è§£ï¼Œè€Œä¸”å–å€¼ä»…ä¸º $0,1$ã€‚é‚£ä¹ˆä¸€å®šå­˜åœ¨ $L_1$  çš„ä¸€ä¸ªæœ€ä¼˜è§£ $z$ï¼Œä½¿å¾— $\tilde z_i=0\Leftrightarrow z_i\le a,\tilde z_i=1\Leftrightarrow z_i\ge b$ã€‚

**è¯æ˜ï¼š**æˆ‘ä»¬æ¥ä¸‹æ¥è¯æ˜ï¼Œè¿™ä¸ª $L_1$ é—®é¢˜å’Œ $S$ é—®é¢˜ç­‰ä»·ã€‚

ç”±äºä»»æ„ç‚¹é›†çš„ $L_p$ å‡å€¼ä¸åœ¨ $(a,b)$ å†…ï¼Œä»è€Œ**ç»“è®º 1** å¯ä»¥åº”ç”¨åˆ°è¿™é‡Œï¼šæ­¤ $S$ é—®é¢˜çš„æœ€ä¼˜è§£å–å€¼åªèƒ½ä¸º $a,b$ã€‚

æ ¹æ®**å¼•ç† 3**ï¼Œå­˜åœ¨ä¸€ç»„è¯¥ $L_1$ é—®é¢˜çš„æœ€ä¼˜è§£å–å€¼ï¼ŒåªåŒ…å« $0,1$ã€‚

æ¥ä¸‹æ¥åªéœ€è¦éªŒè¯ $\tilde w_i|\tilde y_i-0|=w_i|y_i-a|^p,\tilde w_i|\tilde y_i-1|=w_i|y_i-b|^p$ï¼Œè¯»è€…è‡ªè¯ä¸éš¾ï¼Œä»è€Œå¾—åˆ°ç­‰ä»·ã€‚

ç„¶ååªéœ€è¦é‡å¤**å®šç† 1** çš„è¯æ˜è¿‡ç¨‹å³å¯ã€‚ï¼ˆäº‹å®ä¸Šæ¯”å®šç† 1 ç®€å•å¤šäº†ï¼‰$\square$

## è§£æ³•

ç”±äºç‚¹é›† $(x,y)$ æœ‰é™ï¼Œä»è€Œ $L_p$ å‡å€¼å’Œæœ€ä¼˜è§£çš„å–å€¼ä¹Ÿæœ‰é™ï¼ˆå¤§ä¸äº†åœ¨ä¸€ä¸ªé¬¼ç•œæ— æ¯”çš„ $n$ ç»´ç©ºé—´é‡Œå¤§åŠ›æ‰¾è¿™ä¸ªå›å½’çš„æœ€å€¼ç‚¹ï¼Œè€Œä¸”ä¸ä¼šæœ‰åœ¨æŸä¸ªè¾¹ç•Œå­ç©ºé—´é‡Œå…¨æ˜¯æœ€å€¼çš„æƒ…å†µï¼Œå› ä¸ºè¾¹ç•Œä¸€å®šæ˜¯ $z_{i1}=z_{i2}=...$ çš„å½¢å¼ï¼Œå³å®ƒä»¬å–äº†æŸä¸ª $L_p$ å‡å€¼ï¼Œè¿ç”¨**å¼•ç† 1** å³å¾—åˆ°çŸ›ç›¾ï¼‰ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾ä¸€ä¸ª~~çœ‹èµ·æ¥~~è¶³å¤Ÿå°çš„ $\varepsilon$ï¼Œè€ƒè™‘ $b=a+\varepsilon$ã€‚æ­¤æ—¶ $\tilde w_i$ å˜ä¸º $a$ å¤„å›å½’ä»£ä»·çš„å¯¼æ•°ã€‚äºæ˜¯åœ¨å®æ•°ä¸ŠäºŒåˆ†å³å¯ã€‚

# æŠ€å·§å’Œä¾‹é¢˜

## ååºå…³ç³»æ˜¯ä¸€æ¡é“¾çš„æƒ…å†µ

> **å¼•ç† 5.** å½“ååºå…³ç³»æ˜¯ä¸€æ¡é“¾ï¼Œå¦‚æœæœ‰ $y_i>y_{i+1}$ï¼Œé‚£ä¹ˆæœ€ä¼˜è§£å¿…æœ‰ $f_i=f_{i+1}$ã€‚

**è¯æ˜**ï¼šæ˜¾ç„¶ã€‚

ä»è€Œæˆ‘ä»¬å¯ä»¥å•è°ƒæ ˆç»´æŠ¤å„åŒºé—´çš„ $L_p$ å‡å€¼ï¼Œå¦‚æœåé¢çš„å‡å€¼æ¯”å‰é¢å¤§é‚£å°±~~å»ä¸–äº†~~ï¼Œæ˜¾ç„¶åˆå¹¶åè¿™ä¸¤ä¸ªåŒºé—´çš„å–å€¼å…¨ä¼šç›¸ç­‰ï¼Œä»è€Œé‡æ–°è®¡ç®— $L_p$ å‡å€¼å³å¯ã€‚

ç”±äº $L_p(p>1)$ å‡å€¼å”¯ä¸€ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¯”è¾ƒå¥½æ±‚ï¼ˆæ¯”å¦‚ $L_2$ å°±æ˜¯åŠ æƒå¹³å‡å€¼ï¼‰ï¼Œä½†æ˜¯ $L_1$ å‡å€¼æ˜¯ä¸­ä½æ•°ï¼Œå¦‚æœæƒ³è¦ $O(\log n)$ åœ°åˆå¹¶åŒºé—´éœ€è¦ç”¨å¯å¹¶å †ã€‚å½“ç„¶ç›´æ¥å¯å‘å¼åˆå¹¶ $\log^2 n$ ä¹Ÿè¡Œã€‚

### [[BalticOI 2004]Sequence æ•°å­—åºåˆ—](https://www.luogu.com.cn/problem/P4331)

ä»¤ $a_i\leftarrow a_i-i$ï¼Œå°±å˜æˆäº†ä¸€ä¸ªæ ‡å‡†çš„ $L_1$ é—®é¢˜ã€‚åº”ç”¨ä¸Šé¢çš„è§£æ³•å³å¯ã€‚

```cpp
#include<bits/stdc++.h>
using namespace std;

struct leftist{
    int c[2];
    int dis, val;
    int siz;
} H[100005];
void pushup(int x) {
    if (H[H[x].c[1]].dis < H[H[x].c[0]].dis) swap(H[x].c[0], H[x].c[1]);
    H[x].dis = H[H[x].c[0]].dis + 1;
    H[x].siz = H[H[x].c[0]].siz + H[H[x].c[1]].siz + 1;
}
int merge(int x, int y) {
    if (!x || !y) return x + y;
    if (H[x].val < H[y].val) swap(x, y);
    H[x].c[0] = merge(H[x].c[0], y);
    pushup(x);
    return x;
}

int n;

struct node {
    int rt;
    int true_siz;
    int val;
};
node stk[100005]; int len;
int tgt[100005];

int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i++) 
        H[i].dis = 1, scanf("%d", &H[i].val), H[i].val -= i, H[i].siz = 1;
    for (int i = 1; i <= n; i++) {
        stk[++len] = (node){i, 1, H[i].val};
        while (len != 1 && stk[len - 1].val > stk[len].val) {
            len--; stk[len].rt = merge(stk[len].rt, stk[len + 1].rt);
            stk[len].true_siz += stk[len + 1].true_siz;
            while (H[stk[len].rt].siz > (stk[len].true_siz + 1) / 2)
                stk[len].rt = merge(H[stk[len].rt].c[0], H[stk[len].rt].c[1]);
            stk[len].val = H[stk[len].rt].val;
        }
    }
    int cnt = 0, pos = 0;
    long long ans = 0;
    for (int i = 1; i <= n; i++) {
        if (cnt == 0) cnt += stk[++pos].true_siz;
        cnt--;
        tgt[i] = pos;
        ans += abs(H[i].val - stk[pos].val);
    }
    printf("%lld\n", ans);
    for (int i = 1; i <= n; i++) printf("%d ", stk[tgt[i]].val + i);
}
```

### [[HNOI2019]åºåˆ—](https://www.luogu.com.cn/problem/P5294)

è¦åˆ†æ•°å–æ¨¡çš„æœ€ä¼˜åŒ–é—®é¢˜ï¼Œå·²ç»å®Œå…¨æš´éœ²äº†å•Šï¼ˆ

æ ‡å‡†çš„ $L_2$ é—®é¢˜ï¼Œä½†æ˜¯éœ€è¦æ”¯æŒç‰¹æ®Šè¯¢é—®ã€‚

ç”±äºæœ€ä¼˜è§£æ˜¾ç„¶å’Œæˆ‘ä»¬çš„å•è°ƒæ ˆæ‰«æé¡ºåºæ— å…³ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥å¤„ç†å‡ºä¸€ä¸ªå…ƒç´ å‰ç¼€å’Œåç¼€çš„å•è°ƒæ ˆæƒ…å†µã€‚ï¼ˆå¯ä»¥è€ƒè™‘ä¸»å¸­æ ‘ï¼›å…¶å®æŠŠè¯¢é—®ç¦»çº¿ï¼Œä»å·¦åˆ°å³æ‰«æ—¶æš´åŠ›æŠŠå³æ ˆå›é€€ä¹Ÿå¯ä»¥ï¼‰

å‡è®¾ä¿®æ”¹äº†çš„å…ƒç´ æ˜¯ $x$ï¼Œæ˜¾ç„¶ä¸å’Œ $x$ åœ¨åŒä¸€ä¸ªåŒºé—´çš„å…ƒç´ å’Œ $x$ æ²¡æœ‰å…³ç³»ï¼Œä»è€Œç›´æ¥ä½¿ç”¨å¤„ç†å¥½çš„ä¿¡æ¯å³å¯ã€‚ä»è€Œé—®é¢˜å˜ä¸ºæ±‚ $x$ æ‰€åœ¨çš„åŒºé—´ã€‚

è€ƒè™‘å‘å·¦åˆå¹¶ï¼Œå…¶å®å°±æ˜¯æ‰¾åˆ°æœ€å³æ–¹çš„"ç¨³å®š"å·¦ç«¯ç‚¹ $L$ï¼Œå¦‚æœå·²çŸ¥äº† $R$ å®ƒå°±å¯ä»¥ç›´æ¥äºŒåˆ†ï¼›$R$ å¥—åœ¨å¤–é¢äºŒåˆ†å³å¯ã€‚

```cpp
#include<bits/stdc++.h>
typedef long long ll;
using namespace std;

const int maxn = 100005, p = 998244353;
int norm(int x) { return x >= p ? x - p : x; }
int inv[maxn];
void init() {
    inv[1] = 1;
    for (int i = 2; i < maxn; i++)
        inv[i] = 1LL * (p - p / i) * inv[p % i] % p;
}

struct frac {
    ll a;
    int l, r;
    frac operator + (const frac v) const { return (frac){a + v.a, l, v.r}; }
    bool operator < (const frac v) const {
        return (__int128)a * (v.r - v.l + 1) < (__int128)v.a * (r - l + 1);
    }
} suf[maxn], pre[maxn];
int suf_val[maxn], pre_val[maxn];
int ls, lp;
vector<frac> his_del[maxn];

int n, m;
int A[maxn];
ll S1_[maxn];
int S1[maxn], S2[maxn];
frac newfrac(int l, int r, int del = 0) { return (frac){S1_[r] - S1_[l - 1] + del, l, r}; }
int inline getS1(int l, int r) { return norm(S1[r] - S1[l - 1] + p); }
int inline getavg(int l, int r) { return 1LL * getS1(l, r) * inv[r - l + 1] % p; }
int inline getS2(int l, int r) { return norm(S2[r] - S2[l - 1] + p); }
int inline getVAL(int l, int r) {
    int avg = getavg(l, r);
    ll ans = getS2(l, r) - 2LL * avg * getS1(l, r) + 1LL * avg * avg % p * (r - l + 1);
    return norm((int)(ans % p) + p);
}

struct qry {
    int val, id;
}; vector<qry> Qs[maxn];
int ans[maxn];

int get_L(int del, int R) {
    int xL = 0, xR = lp;
    while (xL < xR) {
        int mid = (xL + xR + 1) >> 1;
        if (pre[mid] < newfrac(pre[mid].r + 1, R - 1, del)) xL = mid;
        else xR = mid - 1;
    }
    return xL;
}
pair<int, int> get_R(int del) {
    int xL = 0, xR = ls;
    while (xL < xR) {
        int mid = (xL + xR + 1) >> 1;
        int L = get_L(del, suf[mid].l);
        if (newfrac(pre[L].r + 1, suf[mid].l - 1, del) < suf[mid]) xL = mid;
        else xR = mid - 1;
    }
    return make_pair(get_L(del, suf[xL].l), xL);
}

int main() {
    init();
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i++)
        scanf("%d", &A[i]),
        S1_[i] = S1_[i - 1] + A[i],
        S1[i] = (S1[i - 1] + A[i]) % p,
        S2[i] = (S2[i - 1] + 1LL * A[i] * A[i]) % p;
    for (int i = 1; i <= m; i++) {
        int pos, val;
        scanf("%d%d", &pos, &val);
        Qs[pos].push_back((qry){val - A[pos], i});
    }

    suf[0] = (frac){1, n + 1, n};
    for (int i = n; i; i--) {
        frac now = (frac){A[i], i, i};
        while (ls && suf[ls] < now) {
            his_del[i].push_back(suf[ls]);
            now = now + suf[ls--];
        }
        suf[++ls] = now;
        suf_val[ls] = norm(suf_val[ls - 1] + getVAL(now.l, now.r));
    }
    ans[0] = suf_val[ls];

    for (int i = 1; i <= n; i++) {
        ls--;
        for (int j = his_del[i].size() - 1; j >= 0; j--) {
            suf[++ls] = his_del[i][j];
            suf_val[ls] = norm(suf_val[ls - 1] + getVAL(suf[ls].l, suf[ls].r));
        }

        for (qry e : Qs[i]) {
            pair<int, int> qaq = get_R(e.val);
            ans[e.id] = norm(pre_val[qaq.first] + suf_val[qaq.second]);
            int l = pre[qaq.first].r + 1, r = suf[qaq.second].l - 1;
            // printf("%d %d\n", l - 1, r + 1);
            int avg = 1LL * norm(getS1(l, r) + e.val) * inv[r - l + 1] % p;
            ll tmp = getS2(l, r) - 1LL * A[i] * A[i] + 1LL * (A[i] + e.val) * (A[i] + e.val);
            tmp = norm((int)(tmp % p) + p);
            tmp -= 2LL * avg * norm(getS1(l, r) + e.val);
            tmp += 1LL * avg * avg % p * (r - l + 1);
            tmp = norm((int)(tmp % p) + p);
            ans[e.id] = norm(ans[e.id] + (int)tmp);
        }

        frac now = (frac){A[i], i, i};
        while (lp && now < pre[lp])
            now = pre[lp--] + now;
        pre[++lp] = now;
        pre_val[lp] = norm(pre_val[lp - 1] + getVAL(now.l, now.r));
    }
    
    for (int i = 0; i <= m; i++) printf("%d\n", ans[i]);
}
```

## ç½‘ç»œæµ

å¯¹äº $L_1:S$ é—®é¢˜ï¼Œ$f_i\le f_j$ å¯ä»¥çœ‹æˆé€‰äº† $f_i$ å°±å¿…é¡»é€‰ $f_j$ï¼Œå˜ä¸ºæœ€å¤§æƒé—­åˆå­å›¾é—®é¢˜ï¼Œæ˜¯ä¸€ä¸ªç»å…¸ç½‘ç»œæµä¾‹é¢˜ã€‚

### [[çœé€‰è”è€ƒ 2020 A å·] é­”æ³•å•†åº—](https://www.luogu.com.cn/problem/P6621)

ä¼—æ‰€å‘¨çŸ¥çº¿æ€§åŸºæ˜¯[æ‹Ÿé˜µ](https://xyix.github.io/posts/?&postname=matroid)ã€‚è€ƒè™‘**åŸºäº¤æ¢å¼•ç†**ï¼š

> ç°æœ‰ä¸¤ä¸ªåŸº $A,B$ã€‚å¯¹äºä»»æ„ $x\in A/B$ï¼Œå¿…å­˜åœ¨ $y\in B/A$ ä½¿å¾— $A/\{x\}\cup\{y\}$ æ˜¯ä¸€ä¸ªåŸºã€‚

å³ï¼Œä»»æ„ä¸¤ä¸ªåŸºéƒ½æ˜¯ç›´æ¥å¯ä»¥é€šè¿‡ä¸€æ¬¡"äº¤æ¢"æ“ä½œäº’ç›¸åˆ°è¾¾çš„ã€‚åªéœ€è¦ä¿è¯ï¼š"äº¤æ¢"æ“ä½œæ— æ³•ä½¿ $A$ å˜å°ï¼Œä¹Ÿæ— æ³•ä½¿ $B$ å˜å¤§ã€‚

äºæ˜¯ï¼Œçˆ†æšä¸¾ $A$ï¼ˆrespectivelyï¼Œ$B$ï¼‰ä¸­çš„å…ƒç´ å’Œå…¶å¤–çš„å…ƒç´ ï¼Œå¦‚æœèƒ½äº’ç›¸æ›¿æ¢å°±æœ‰ååºå…³ç³»ã€‚

æœ€ååº”ç”¨ä¸Š[ä¿åºå›å½’](https://xyix.github.io/posts/?&postname=isotonic-regression)å°±åšå®Œäº†ï¼ï¼ï¼

# $p=\infty$ çš„æƒ…å†µå’Œæ‰©å±•

ğŸ•Šäº†