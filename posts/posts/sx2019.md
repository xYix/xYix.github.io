---
title: çœé€‰ 2019 è¡¥é¢˜è®°å½•
date: 2020-09-11 15:07:39
tags:
- $\color{red}ç²¾å“$
- $\color{green}å’•å’•$
---

å¦‚é¢˜ã€‚

<!--more-->

ç›®å‰è¿›åº¦ï¼š

||T1ä»£ç |T1é¢˜è§£|T2ä»£ç |T2é¢˜è§£|T3ä»£ç |T3é¢˜è§£|
|---|---|---|---|---|---|---|---|
|ZJOI2019 Day1|$\sqrt{}$|$\sqrt{}$|$\sqrt{}$|$\sqrt{}$|$\sqrt{}$|$\sqrt{}$|
|ZJOI2019 Day2|$\sqrt{}$|$\sqrt{}$|$\sqrt{}$|$\sqrt{}$|||

# ZJOI2019 Day1

## T1

[é¢˜ç›®é“¾æ¥](https://www.luogu.com.cn/problem/P5279)

å¯¹éº»å°†çš„çƒ­çˆ±æ¶ˆå¤±æ®†å°½äº†ï¼ˆæ‚²ï¼‰

è€ƒè™‘æ€ä¹ˆåˆ¤æ–­ä¸€å‰¯ç‰Œæ˜¯èƒ¡çš„ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ª DP åšæ³•ï¼šè®¾ $f_{i,j_1,j_0,k}$ æ˜¯è€ƒè™‘é¢å€¼ä¸º $1...i$ çš„æ‰€æœ‰ç‰Œï¼Œé¢„ç•™çš„ $(i-1,i,i+1)$ é¡ºå­æ•°ç›®ä¸º $j_1$ï¼Œé¢„ç•™çš„ $(i,i+1,i+2)$ é¡ºå­æ•°ç›®ä¸º $j_0$ï¼Œ$k$ æ˜¯æœ‰æ²¡æœ‰é¢„ç•™è¿‡å¯¹å­ï¼Œçš„æœ€å¤§é¢å­æ•°ã€‚è¿˜è¦å†åŠ ä¸€ç»´è¡¨ç¤ºæ€»å…±æœ‰å¤šå°‘å¯¹å­æ¥åˆ¤æ–­ä¸ƒå¯¹å­ã€‚æ˜¾ç„¶ $j_1,j_0<3$ï¼Œå¦åˆ™å¯ä»¥æ‹†æˆåˆ»å­ã€‚

åˆ¤æ–­èƒ½å¦èƒ¡ç‰Œå¾ˆç®€å•ï¼Œ$f_i,\star,\star,1$ ä¸­æœ‰ä¸€ä¸ªå¤§äºç­‰äº $4$ æˆ–è€…æœ‰ä¸ƒä¸ªå¯¹å­å³å¯ã€‚

æ˜¾ç„¶è¿™ä¸ª DP å’Œ $i$ å®Œå…¨æ²¡æœ‰å…³ç³»ï¼Œå’Œ $k$ ä¹Ÿå…³ç³»ä¸å¤§ï¼Œå®ƒå¯ä»¥çœ‹æˆä¸€ä¸ª $2\times 3\times 3$ çš„çŸ©é˜µï¼Œæ¥å—ä¸€ä¸ªæ•°åè½¬ç§»æˆå¦ä¸€ä¸ªçŸ©é˜µï¼Œå¯ä»¥çœ‹æˆä¸€ä¸ª**è‡ªåŠ¨æœº**ã€‚èµ°åˆ°èƒ¡èŠ‚ç‚¹å³èƒ¡ç‰Œã€‚

é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘åœ¨è¿™ä¸ªè‡ªåŠ¨æœºä¸Š DP äº†ï¼Œè®¾ $g_{i,j,p}$ æ˜¯è€ƒè™‘äº†é¢å€¼ä¸º $1...i$ çš„ç‰Œï¼Œæ‘¸äº†å…¶ä¸­ $j$ å¼ ï¼Œèµ°åˆ°äº†è‡ªåŠ¨æœºèŠ‚ç‚¹ $p$ çš„æ¦‚ç‡ã€‚æˆ‘ä»¬éƒ½çŸ¥é“èƒ¡ç‰ŒæœŸæœ›å°±æ˜¯ $\sum_{i=0}^\infty P(\texttt{æ‘¸äº† i å¼ ç‰Œè¿˜ä¸èƒ¡})$ï¼Œå¤§åŠ› DP å³å¯ã€‚

ä»£ç å¦‚ä¸‹ï¼Œå†™å¾—ç®€ç›´è®©äººæƒ³åï¼š

```cpp
#include<bits/stdc++.h>
using namespace std;

struct Mat{
	int a[3][3];
	Mat (bool flg=0){memset(a,-1,sizeof(a));if(flg) a[0][0]=0;}
	Mat calc(Mat &c,const int x){
		for(int j2=0;j2<3;j2++)
		for(int j1=0;j1<3;j1++)if(a[j2][j1]!=-1)
		for(int j0=0;j0<3&&j2+j1+j0<=x;j0++)
			c.a[j1][j0]=max(c.a[j1][j0],min(a[j2][j1]+j2+(x-j2-j1-j0)/3,4));
		return c;
	}
	bool operator <(const Mat b)const{
		for(int j1=0;j1<3;j1++)
		for(int j0=0;j0<3;j0++)
			if(a[j1][j0]!=b.a[j1][j0]) return a[j1][j0]<b.a[j1][j0];
		return 0;
	}
	bool operator !=(const Mat b)const{
		for(int j1=0;j1<3;j1++)
		for(int j0=0;j0<3;j0++)
			if(a[j1][j0]!=b.a[j1][j0]) return 1;
		return 0;
	}
	bool const ishu()const{
		for(int j1=0;j1<3;j1++)
		for(int j0=0;j0<3;j0++)
			if(a[j1][j0]>=4) return 1;
		return 0;
	}
};
struct AM{  //è‡ªåŠ¨æœºæ€ªï¼ 
	Mat F[2];int dbcnt;
	AM (bool flg=0){if(!flg) F[0]=F[1]=Mat(),dbcnt=-0x3f3f3f3f;else F[0]=Mat(1),F[1]=Mat(),dbcnt=0;}
	void HU(){dbcnt=998244353;F[0]=F[1]=Mat();}
	bool ishu(){
		if(dbcnt==998244353) return 1;
		if(dbcnt>=7){HU();return 1;}
		if(F[1].ishu()){HU();return 1;}
		return 0;
	}
	bool operator <(const AM b)const{
		if(dbcnt!=b.dbcnt) return dbcnt<b.dbcnt;
		if(F[0]!=b.F[0]) return F[0]<b.F[0];
		if(F[1]!=b.F[1]) return F[1]<b.F[1];
		return 0; 
	}
	AM calc(int x){
		if(ishu()) return (*this);
		AM c;
		if(x>=2) F[0].calc(c.F[1],x-2);
		F[0].calc(c.F[0],x);
		F[1].calc(c.F[1],x);
		c.dbcnt=dbcnt+(x>=2);
		c.ishu();
		return c; 
	}
};
map<AM,int>id;int tot;int G[2500][5];queue<AM> que;
int T;
void BFS(){
	AM st(1);
	que.push(st);id[st]=++tot;
	while(!que.empty()){
		AM u=que.front();que.pop();
		if(u.ishu()){T=id[u];continue;}
		for(int x=0;x<=4;x++){
			AM v=u.calc(x);
			if(id.count(v)) G[id[u]][x]=id[v];
			else G[id[u]][x]=id[v]=++tot,que.push(v);
		}
	}
}

const int p=998244353;
int fac[2500],ifac[2500],inv[2500];
void init(){
	inv[1]=fac[0]=fac[1]=ifac[0]=ifac[1]=1;
	for(int i=2;i<2500;i++)
		inv[i]=1LL*(p-p/i)*inv[p%i]%p,
		fac[i]=1LL*fac[i-1]*i%p,
		ifac[i]=1LL*ifac[i-1]*inv[i]%p;
}

int N,A[105];

int F[105][405][2500];
int val[5];

int main(){
	init();BFS();
	scanf("%d",&N);
	for(int i=1;i<=13;i++){int x,y;scanf("%d%d",&x,&y);A[x]++;}
	F[0][0][1]=1;
	for(int d=1;d<=N;d++){
		for(int k=0;k<=4-A[d];k++) val[k]=1LL*fac[4-A[d]]*ifac[k]%p*ifac[4-A[d]-k]%p;
		for(int i=0;i<=4*N-13;i++)
		for(int j=1;j<=tot;j++)
		for(int k=A[d];k<=4;k++)
			(F[d][i+k-A[d]][G[j][k]]+=1LL*F[d-1][i][j]*val[k-A[d]]%p)%=p; 
	}
	int ans=0;
	for(int i=0;i<=4*N-13;i++)
	for(int j=1;j<=tot;j++) if(j!=T)
		(ans+=1LL*F[N][i][j]*fac[i]%p*fac[4*N-13-i]%p)%=p;
	printf("%d\n",1LL*ans*ifac[4*N-13]%p);
}
```

## T2

[é¢˜ç›®é“¾æ¥](https://www.luogu.com.cn/problem/P5280)

<div style="width:70%;margin:auto"><img src="https://xyix.gitee.io/images/zjoi2020d1t2.png" alt=""></div>

è€ƒè™‘ç»´æŠ¤ $f_u$ ä¸º $u$ æœ‰ tag çš„æ¦‚ç‡ï¼Œ$g_u$ ä¸º $u$ åŠå…¶ç¥–å…ˆä¸­è‡³å°‘æœ‰ä¸€ä¸ª tag çš„æ¦‚ç‡ã€‚

åˆ†å¦‚ä¸Šäº”ç±»ç‚¹å¤§åŠ›è®¨è®ºï¼š

- ç™½è‰²

$$
f\leftarrow \dfrac f2,g\leftarrow \dfrac g2
$$

- çº¢è‰²

$$
f\leftarrow \dfrac {f+1}{2},g\leftarrow \dfrac{g+1}2
$$

- ç°è‰²

$$
f\leftarrow f,g\leftarrow\dfrac{g+1}2
$$

- é»„è‰²

$$
f\leftarrow f,g\leftarrow g
$$

- æ©™è‰²

$$
f\leftarrow\dfrac{f+g}2,g\leftarrow g
$$

ç„¶åçº¿æ®µæ ‘ç»´æŠ¤å³å¯ã€‚

å› ä¸æ˜åŸå› è¦å¼€ 8 å€ç©ºé—´ï¼Ÿ

```cpp
#include<bits/stdc++.h>
using namespace std;

const int p=998244353,inv2=(p+1)/2;
void inline check(int &x){x-=p,x+=x>>31&p;}
int N,M;

int pow2[200005];
int f[800005],g[800005],sf[800005],lzy[800005];
void add(int x,int k){
	check(g[x]=1LL*g[x]*pow2[k]%p+1-pow2[k]+p);
	lzy[x]+=k;
}
void pushup(int x){check(sf[x]=f[x]+sf[x<<1]);check(sf[x]+=sf[x<<1|1]);}
void pushdown(int x){
	if(!lzy[x]) return;
	add(x<<1,lzy[x]);add(x<<1|1,lzy[x]);lzy[x]=0;
}
void Update(int x,int l,int r,int L,int R){
	if(r<L||l>R){//orange
		check(f[x]+=g[x]);f[x]=1LL*f[x]*inv2%p;
		pushup(x);return;
	}
	if(L<=l&&r<=R){//red
		f[x]=1LL*(f[x]+1)*inv2%p;g[x]=1LL*(g[x]+1)*inv2%p;
		if(l!=r) pushdown(x),add(x<<1,1),add(x<<1|1,1);//gray
		pushup(x);return;
	}
	f[x]=1LL*f[x]*inv2%p,g[x]=1LL*g[x]*inv2%p;//white
	int mid=(l+r)>>1;pushdown(x);
	Update(x<<1,l,mid,L,R);Update(x<<1|1,mid+1,r,L,R);
	pushup(x);
}
void Query(int x,int l,int r){
	printf("check [%d,%d] : %d %d\n",l,r,f[x],g[x]);
	if(l!=r){
		int mid=(l+r)>>1;pushdown(x);
		Query(x<<1,l,mid);Query(x<<1|1,mid+1,r);
	}
}

int main(){
	pow2[0]=1;for(int i=1;i<=200000;i++) pow2[i]=1LL*pow2[i-1]*inv2%p;
	scanf("%d%d",&N,&M);
	int ans=1;
	for(int i=1;i<=M;i++){
		int opt;scanf("%d",&opt);
		if(opt==1){
			int L,R;scanf("%d%d",&L,&R);
			Update(1,1,N,L,R);
			check(ans+=ans);
		}
		else printf("%d\n",1LL*sf[1]*ans%p);
	}
} 
```

## T3

[é¢˜ç›®é“¾æ¥](https://www.luogu.com.cn/problem/P5281)

è€ƒè™‘å·®åˆ†ï¼šæ±‚ç¨³å®šåº¦ $\le k$ çš„é›†åˆæ•°é‡ã€‚

è®°æŸä¸ªç‚¹ $u$ çš„æƒå€¼ä¸º $v(u)$ã€‚è€ƒè™‘ $v=W$ çš„èŠ‚ç‚¹æ˜¾ç„¶å½¢æˆäº†ä¸€æ¡ç”±æ ¹åˆ°å¶å­çš„é“¾ã€‚æ¯ä¸ªå…¶ä»–å¶å­ä¹Ÿä¼šå‘ä¸Šå»¶ä¼¸å‡ºä¸€æ¡é“¾ï¼Œç›´åˆ°æ’åˆ°ä¸»é“¾æˆ–è€…å…¶ä»–é“¾ã€‚

åªè¦ä¸»é“¾ä¸Šæœ‰ä¸€ä¸ªç‚¹æ”¹å˜ $W$ å°±ä¼ ä¸åˆ°æ ¹äº†ï¼›äºæ˜¯å¯ä»¥æ–­å¼€ä¸»é“¾ä¸Šçš„æ‰€æœ‰è¾¹åˆ†åˆ«è€ƒè™‘ã€‚

è€ƒè™‘å¯¹å¶å­èŠ‚ç‚¹çš„ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœå½“å‰æ ¹çš„æ·±åº¦ä¸ºå¥‡æ•°ï¼Œé‚£ä¹ˆå¿…ç„¶å– $W+1$ï¼šæ—¢èƒ½æœ€ç»ˆèƒœè¿‡ $W$ï¼Œåˆæ›´ä¸å®¹æ˜“å› ä¸ºå¤ªå¤§åœ¨å¶æ•°æ·±åº¦è¢«æ·˜æ±°ã€‚å¶æ•°åŒç†ã€‚äºæ˜¯å¯¹äºç¡®å®šçš„ $k$ï¼Œæ¯ä¸ªå¶å­çš„ç­–ç•¥æ˜¯**ç¡®å®š**çš„ï¼Œå’Œ ``rand()`` å‡ºçš„é›†åˆæ— å…³ã€‚

è€ƒè™‘ DPï¼š$\text{f}_u$ è¡¨ç¤ºï¼šå¯¹äºæ·±åº¦ä¸ºå¥‡æ•°çš„ $u$ï¼Œæœ‰å¤šå°‘ç§å¶å­é›†åˆèƒ½è®© $v(u)>W$ã€‚å¯¹äºå¶æ•°åä¹‹ã€‚

â€œèƒ½â€å­—åœ¨è¿™é‡Œå¯èƒ½å¼•å‘è¯¯è§£ï¼šå¯¹äºæ¯ä¸ªé›†åˆï¼Œç­–ç•¥æ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œä¸ä¼šæœ‰å“ªä¸ªé›†åˆæ—¢â€œèƒ½â€ä½¿ $v\le W$ åˆâ€œèƒ½â€ä½¿ $v>W$ã€‚

è®° $u$ å­æ ‘ä¸­çš„å¶å­æ•°ä¸º $\text{siz}_u$ã€‚

æ˜ç¡®å®Œäº†ä¸Šé¢å‡ ç‚¹ï¼Œæ¥ä¸‹æ¥å†™ DP æ–¹ç¨‹ã€‚

$$
\text{f}_u=2^{\text{siz}_u}-\prod_{v\in \text{son}_u}\text{f}_v
$$

å¯¹äºå¶å­èŠ‚ç‚¹ï¼Œ

$$
\text{f}_u=\begin{cases}[u>W]+[u+k>W]&(\text{dep}_u\bmod 2=1)\\ [u<W]+[u-k<W]&(\text{dep}_u\bmod 2 =0)\end{cases}
$$

æœ€ç»ˆè®¡ç®—ç­”æ¡ˆæ—¶åªéœ€è¦æŠŠæ¯ä¸ªä¸»é“¾ä¸Šçš„èŠ‚ç‚¹ä¹˜èµ·æ¥ã€‚

å½“ $k$ å˜åŠ¨æ—¶æ¯ä¸ªå¶å­çš„ $\text{f}$ åªä¼šå˜åŠ¨ä¸€æ¬¡ï¼Œæç¤ºæˆ‘ä»¬åŠ¨æ€ DPã€‚äºæ˜¯å°±åšå®Œäº†ã€‚æ³¨æ„ç”±äº $\text{f}_v$ å¯èƒ½ä¸º 0ï¼Œè€Œé™¤ä»¥ 0 éå¸¸éº»çƒ¦ï¼Œæ‰€ä»¥è€ƒè™‘ä»å¤§åˆ°å°æšä¸¾ $k$ã€‚

æ€è·¯éå¸¸çº¿æ€§ï¼Œå†·é™åˆ†æä¸€ä¸‹åº”è¯¥ä¸ç®—å¤ªéš¾ï¼Ÿ~~é‚£ä¹ˆé—®é¢˜æ¥äº†è¯¥å¦‚ä½•å­¦ä¼šå†·é™åˆ†æå‘¢~~

ä»£ç éå¸¸æ¶å¿ƒâ€¦â€¦çœ‹æ¥è°ƒè¯•èƒ½åŠ›ä¹Ÿæ˜¯ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†å•Šâ€¦â€¦

```cpp
#include<bits/stdc++.h>
using namespace std;

const int maxN=400005;

int N,L,R;
vector<int> G[maxN];
void add_E(int u,int v){G[u].push_back(v);}

int tf[maxN],W;
int lsiz[maxN],dep[maxN];
vector<int> Ls;
bool isleaf(int x){return G[x].size()==1&&x!=1;}
void init1(int u,int f){
	dep[u]=dep[f]+1;
	if(isleaf(u)){Ls.push_back(u);tf[u]=u;return;}
	if(dep[u]&1) tf[u]=-0x3f3f3f3f;else tf[u]=0x3f3f3f3f;
	for(auto v : G[u]) if(v!=f){
		init1(v,u);
		if(dep[u]&1) tf[u]=max(tf[u],tf[v]);else tf[u]=min(tf[u],tf[v]);
	}
}

int fa[maxN],siz[maxN],son[maxN];
int top[maxN],tal[maxN],seg[maxN],rev[maxN],idx;
void dfs1(int u,int f){
	fa[u]=f;siz[u]=1;
	for(auto v : G[u]) if(v!=f&&tf[v]!=W){
		dfs1(v,u);siz[u]+=siz[v];
		if(siz[v]>siz[son[u]]) son[u]=v;
	}
} 
void dfs2(int u,int f){
	top[u]=(u==son[f]?top[f]:u);
	rev[seg[u]=++idx]=u;
	if(son[u]) dfs2(son[u],u),tal[u]=tal[son[u]];else tal[u]=u;
	for(auto v : G[u]) if(v!=f&&v!=son[u]&&tf[v]!=W) dfs2(v,u);
}

const int p=998244353; 
int qpow(int a,int k){
	int ans=1;
	while(k){
		if(k&1) ans=1LL*ans*a%p;
		a=1LL*a*a%p;
		k>>=1;
	}
	return ans;
}
int pow2[maxN];
struct Mat{
	int k,b;
	Mat (int k0=1,int b0=0){k=k0,b=b0;}
	Mat operator *(const Mat y)const{
		return Mat(1LL*k*y.k%p,(1LL*k*y.b%p+b)%p);
	}
}T[maxN<<2],initT[maxN];
int F[maxN],rt[maxN];
int calc(int u,int K){
	if(dep[rt[u]]&1)
		if(dep[u]&1) return (u>W)+(u+K>W);
		else return (u<=W)+(u+K<=W);
	else if(dep[u]&1) return (u>=W)+(u-K>=W);
		else return (u<W)+(u-K<W);
}
void init2(int u,int f,int rt0){
	rt[u]=rt0;
	if(isleaf(u)){
		lsiz[u]=1;
		initT[u].b=F[u]=calc(u,N-1);
		return;
	}
	initT[u].k=p-1;F[u]=1;
	for(auto v : G[u]) if(v!=f&&tf[v]!=W){
		init2(v,u,rt0);lsiz[u]+=lsiz[v];
		if(v!=son[u]) initT[u].k=1LL*initT[u].k*F[v]%p;
		F[u]=1LL*F[u]*F[v]%p;
	}
	F[u]=(pow2[lsiz[u]]-F[u]+p)%p;initT[u].b=pow2[lsiz[u]];
}
int ans=1; //å½“å‰ç¨³å®šçš„é›†åˆæ•° 
int ANS[maxN];

void Build(int x,int l,int r){
	if(l==r){T[x]=initT[rev[l]];return;}
	int mid=(l+r)>>1;
	Build(x<<1,l,mid);Build(x<<1|1,mid+1,r);
	T[x]=T[x<<1]*T[x<<1|1];
}
void Update(int x,int l,int r,int pos){
	if(l==r){T[x]=initT[rev[l]];return;}
	int mid=(l+r)>>1;
	if(pos<=mid) Update(x<<1,l,mid,pos);
	if(pos>mid) Update(x<<1|1,mid+1,r,pos);
	T[x]=T[x<<1]*T[x<<1|1];
}
Mat Query(int x,int l,int r,int L,int R){
	if(L<=l&&r<=R) return T[x];
	int mid=(l+r)>>1;
	if(L>mid) return Query(x<<1|1,mid+1,r,L,R);
	if(R<=mid) return Query(x<<1,l,mid,L,R);
	return Query(x<<1,l,mid,L,R)*Query(x<<1|1,mid+1,r,L,R);
}
vector<int> upds[maxN];

int main(){
	pow2[0]=1;for(int i=1;i<maxN;i++) pow2[i]=(pow2[i-1]<<1)%p;
	scanf("%d%d%d",&N,&L,&R);
	for(int i=1;i<N;i++){
		int u,v;scanf("%d%d",&u,&v);
		add_E(u,v);add_E(v,u);
	}
	init1(1,0);W=tf[1];
	for(int i=1;i<=N;i++) if(tf[i]==W) dfs1(i,0);
	for(int i=1;i<=N;i++) if(tf[i]==W) dfs2(i,0);
	for(int i=1;i<=N;i++) if(tf[i]==W) init2(i,0,i);
	for(int i=1;i<=N;i++) if(tf[i]==W) ans=1LL*(pow2[lsiz[i]]-F[i]+p)%p*ans%p;
	Build(1,1,N);
	for(auto u : Ls)
		if(dep[rt[u]]&1)
			if(dep[u]&1) {if(W-u>=0) upds[W-u].push_back(u);}
			else {if(W-u>=0) upds[W-u].push_back(u);}
		else if(dep[u]&1) {if(u-W>=0) upds[u-W].push_back(u);}
			else {if(u-W>=0) upds[u-W].push_back(u);}
	ANS[N]=ans-1;
	for(int K=N-2;K>=0;K--){
		int tans=ans;
		for(auto u : upds[K]){
			if(u!=rt[u]) initT[u].b=calc(u,K);else initT[u].b=0;
			int bef,aft;
			while(1){
				bef=Query(1,1,N,seg[top[u]],seg[tal[u]]).b;
				Update(1,1,N,seg[u]);
				aft=Query(1,1,N,seg[top[u]],seg[tal[u]]).b;
				if(fa[top[u]]){
					u=fa[top[u]];
					initT[u].k=1LL*initT[u].k*qpow(bef,p-2)%p*aft%p;
				}
				else{
					u=top[u];
					ans=1LL*(pow2[lsiz[u]]-aft+p)%p*ans%p*qpow((pow2[lsiz[u]]-bef+p)%p,p-2)%p;
					break;
				}
			}
		}
		ANS[K+1]=(ans-tans+p)%p;
	}
	for(int i=L;i<=R;i++) printf("%d ",ANS[i]);
}
```

# ZJOI2019 Day2

è§‰å¾— Day2 æ¯” Day1 ç®€å•æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ

## T1

[é¢˜ç›®é“¾æ¥](https://www.luogu.com.cn/problem/P5326)

é¦–å…ˆè€ƒè™‘â€œç¬¬ä¸€æ¬¡â€æ€ä¹ˆå¤„ç†ã€‚è®¾ $F$ æ˜¯ $i$ æ­¥æ“ä½œæ°å¥½ç¬¬ä¸€æ¬¡è¾¾æˆç›®æ ‡çš„ OGFï¼Œ$G$ æ˜¯ $i$ æ­¥æ“ä½œèµ°å›åŸçŠ¶æ€çš„ OGFï¼Œ$H$ æ˜¯ $i$ æ­¥æ“ä½œè¾¾æˆç›®æ ‡çš„ OGFã€‚æ˜¾ç„¶æœ‰

$$
F\times G=H
$$

è€Œ $g$ å°±æ˜¯æŠŠç»ˆçŠ¶æ€æ”¹æ‰çš„ $H$ã€‚

ä»¤ $p_i\leftarrow p_i/\sum p$ï¼Œå®¹æ˜“å†™å‡º $\hat H$ï¼ˆ$\hat{\ }$ è¡¨ç¤ºEGFï¼‰ä¸º

$$
\prod_{s_i=0}\left(\dfrac{e^{p_ix}+e^{-p_ix}}{2}\right)\prod_{s_i=1}\left(\dfrac{e^{p_ix}-e^{-p_ix}}{2}\right)
$$

å¯¹ $e^{ix/\sum p}$ å¤§åŠ› DPã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥å¾—åˆ°

$$
\hat H=\sum_{i=-\sum p}^{\sum p} h_ie^{ix/\sum p}
$$

$$
n![x^n]\hat H=\sum_{i=-\sum p}^{\sum p}h_i\left(\dfrac{ix}{\sum p}\right)^n
$$

$$
\boxed{H=\sum_{i=-\sum p}^{\sum p}\dfrac{h_i}{1-(i/\sum p)x}}
$$

ä¼—æ‰€å‘¨çŸ¥æ¦‚ç‡ç”Ÿæˆå‡½æ•°æ±‚å¯¼ååœ¨ 1 å¤„çš„å€¼å°±æ˜¯æœŸæœ›ï¼š

$$
F'(1)=\dfrac{H(1)'G(1)-H(1)G'(1)}{G(1)^2}
$$

è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ã€‚$x=1$ æ—¶è¿™æ˜¯ä¸€ä¸ª $\dfrac{\infty}{\infty}$ å½¢çš„æé™ï¼Œè€Œæ´›å¿…è¾¾åªä¼šè¶Šæ´›è¶Šå¤æ‚ã€‚è¿™é‡Œè€ƒè™‘ç»™ $H,G$ éƒ½ä¹˜ä¸Š $1-x$ å°±æ²¡è¿™ä¸ªé—®é¢˜äº†ã€‚

å…·ä½“å¼å­å¿˜äº†ã€‚ä»£ç å¦‚ä¸‹ï¼š

```cpp
#include<bits/stdc++.h>
using namespace std;

const int p=998244353,inv2=499122177;
const int maxN=105,maxP=50005;

int qpow(int a,int k){
	int ans=1;
	while(k){
		if(k&1) ans=1LL*ans*a%p;
		a=1LL*a*a%p;
		k>>=1;
	} 
	return ans;
}

int N,SP;
int _A[maxP<<1],_B[maxP<<1],*A=_A+maxP,*B=_B+maxP;
int _tA[maxP<<1],_tB[maxP<<1],*tA=_tA+maxP,*tB=_tB+maxP;
int s[maxN],P[maxN];

int main(){
	scanf("%d",&N);
	for(int i=1;i<=N;i++) scanf("%d",&s[i]);
	A[0]=B[0]=1;
	for(int i=1;i<=N;i++){
		scanf("%d",&P[i]);
		for(int j=-SP-P[i];j<=SP+P[i];j++) tA[j]=tB[j]=0;
		for(int j=-SP;j<=SP;j++){
			tA[j+P[i]]=(tA[j+P[i]]+1LL*inv2*A[j]%p)%p;
			if(s[i]&1)
				tA[j-P[i]]=(tA[j-P[i]]-1LL*inv2*A[j]%p+p)%p;
			else
				tA[j-P[i]]=(tA[j-P[i]]+1LL*inv2*A[j]%p)%p;
			tB[j+P[i]]=(tB[j+P[i]]+1LL*inv2*B[j]%p)%p;
			tB[j-P[i]]=(tB[j-P[i]]+1LL*inv2*B[j]%p)%p;
		}
		swap(tA,A);swap(tB,B);
		SP+=P[i];
	}
	int invSP=qpow(SP,p-2),ans=0;
	for(int j=-SP;j<=SP;j++)
		ans=(ans+1LL*(1LL*A[j]*B[SP]%p-1LL*A[SP]*B[j]%p+p)%p*qpow((1LL*(j+p)%p*invSP%p-1+p)%p,p-2)%p)%p;
	ans=1LL*ans*qpow(B[SP],p-3)%p;
	printf("%d\n",ans);
}
```

## T2

[é¢˜ç›®é“¾æ¥](https://www.luogu.com.cn/problem/P5327)

è€ƒè™‘ä¸€ä¸ªç‚¹ $u$ èƒ½åˆ°è¾¾çš„ $v$ã€‚æ˜¾ç„¶æ˜¯ä¸€å †é€šè¿‡äº† $u$ çš„é“¾ä¹‹å¹¶ã€‚äº‹å®ä¸Šå†å†·é™åˆ†æä¸€ä¸‹ä½ ä¼šå‘ç°è¿™æ˜¯ä¸€ä¸ªè™šæ ‘çš„å¤§å°ã€‚é“¾ä¸Šæ‰“ tag ä¹‹ç±»çš„ä¸œè¥¿å¿…ç„¶è¦ä¸¤ä¸ª log ä»¥ä¸Šï¼Œè€ƒè™‘æ ‘ä¸Šå·®åˆ†ã€‚åˆå¹¶çš„æ—¶å€™çº¿æ®µæ ‘åˆå¹¶å³å¯ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```cpp
#include<bits/stdc++.h>
#define ll long long
using namespace std;

const int maxN=100005;
int N,M; 

int lnk[maxN];
int pre[maxN<<1],tgt[maxN<<1],cnt;
void add_E(int u,int v){
	pre[++cnt]=lnk[u],tgt[cnt]=v,lnk[u]=cnt;
}
int Tin[maxN],idx0,T[maxN<<1];
int dfn[maxN],idx1;
int dep[maxN],fa[maxN];
void dfs(int x,int f){
	dfn[x]=++idx1;
	Tin[x]=++idx0;T[idx0]=x;
	for(int e=lnk[x];e;e=pre[e])if(tgt[e]!=f)
		dep[tgt[e]]=dep[x]+1,fa[tgt[e]]=x,dfs(tgt[e],x),T[++idx0]=x;
}
int lg2[maxN<<1],ST[maxN<<1][20]; 
int mymin(int u,int v){
	return dep[u]<dep[v]?u:v;
}
void Get_ST(){
	lg2[0]=-1;
	for(int i=1;i<=N<<1;i++) lg2[i]=lg2[i>>1]+1;
	for(int i=idx0;i;i--){
		ST[i][0]=T[i];
		for(int k=1;i+(1<<k)-1<=idx0;k++)
			ST[i][k]=mymin(ST[i][k-1],ST[i+(1<<(k-1))][k-1]);
	}
}
int LCA(int u,int v){
	if(!u||!v) return 0;
	u=Tin[u],v=Tin[v];
	if(u>v) swap(u,v);
	int k=lg2[v-u+1];
	return mymin(ST[u][k],ST[v-(1<<k)+1][k]);
}

int RT[maxN];
int Ln[maxN*80],Rn[maxN*80],C[maxN*80],lc[maxN*80],rc[maxN*80],tot;
ll F[maxN*80];
void pushup(int x){
	C[x]=C[lc[x]]+C[rc[x]];
	Ln[x]=Ln[lc[x]]?Ln[lc[x]]:Ln[rc[x]];
	Rn[x]=Rn[rc[x]]?Rn[rc[x]]:Rn[lc[x]];
	F[x]=F[lc[x]]+F[rc[x]]-dep[LCA(Rn[lc[x]],Ln[rc[x]])];
} 
void Update(int &x,int l,int r,int pos,bool flg){
	if(!x) x=++tot;
	if(l==r){
		if(flg){C[x]--;if(!C[x]) F[x]=Ln[x]=Rn[x]=0;}
		else{if(!C[x]) F[x]=dep[pos],Ln[x]=Rn[x]=pos;C[x]++;} 
		return;
	}
	int mid=(l+r)>>1;
	if(dfn[pos]<=mid) Update(lc[x],l,mid,pos,flg);
	else Update(rc[x],mid+1,r,pos,flg);
	pushup(x);
}
ll Query(int x){
	return F[x]-dep[LCA(Ln[x],Rn[x])];
}
void Merge(int &x,int y,int l,int r){
	if(!x||!y){x=x+y;return;}
	if(l==r){
		Ln[x]|=Ln[y];Rn[x]|=Rn[y];F[x]|=F[y];C[x]+=C[y];
		return;
	}
	int mid=(l+r)>>1;
	Merge(lc[x],lc[y],l,mid);
	Merge(rc[x],rc[y],mid+1,r);
	pushup(x);
}
void Debug(int x,int l,int r){
	if(!x){return;}
	if(l==r){return;}
	int mid=(l+r)>>1;
	Debug(lc[x],l,mid);Debug(rc[x],mid+1,r);
}

vector<int> Inc[maxN],Dec[maxN];
ll ans;
void Solve(int u){
	for(int j=0;j<Inc[u].size();j++)
		Update(RT[u],1,N,Inc[u][j],0);
	for(int e=lnk[u];e;e=pre[e]) if(tgt[e]!=fa[u]) Solve(tgt[e]);
	for(int j=0;j<Dec[u].size();j++)
		Update(RT[u],1,N,Dec[u][j],1);
	ans+=Query(RT[u]);
	Merge(RT[fa[u]],RT[u],1,N);
}

int main(){
	scanf("%d%d",&N,&M);
	for(int i=1;i<N;i++){
		int u,v;scanf("%d%d",&u,&v);
		add_E(u,v);add_E(v,u);
	}
	dfs(1,0);Get_ST();
	for(int i=1;i<=M;i++){
		int u,v,w;scanf("%d%d",&u,&v);w=LCA(u,v);
		Dec[w].push_back(u);Dec[w].push_back(v);
		Dec[fa[w]].push_back(u);Dec[fa[w]].push_back(v);
		Inc[u].push_back(u);Inc[u].push_back(v);
		Inc[v].push_back(u);Inc[v].push_back(v);
	}
	Solve(1);
	printf("%d\n",ans>>1);
	return 0;
}
```

## T3

[é¢˜ç›®é“¾æ¥](https://www.luogu.com.cn/problem/P5328)

æ¯ä¸ªé€‰æ‰‹çš„æˆç»©éƒ½æ˜¯ç›´çº¿ï¼Œé‚£ä¹ˆå¯ä»¥æƒ³åˆ°çš„æ˜¯åšä¸€æ¬¡åŠå¹³é¢äº¤å³å¯æ‰¾å‡ºä¸€ä¸ªå‡¸å£³ï¼ŒğŸ†çˆ·åªèƒ½åœ¨å…¶ä¸­é€‰ã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ $x$ åªèƒ½å–**éè´Ÿæ•´æ•°**ï¼Œä¼˜åŠ¿åŒºé—´é•¿åº¦ä¸º eps çš„é‚£äº›ä¸èƒ½ç®—ã€‚

å»æ‰æ‰€æœ‰çš„ğŸ†çˆ·ï¼Œç„¶åçœ‹çœ‹å‰©ä¸‹çš„çº¿æœ‰æ²¡æœ‰ğŸ¥ˆã€‚åŸå…ˆçš„ğŸ†çˆ·è‡ªç„¶ä¼šæŠŠåˆ«äººè¸©ä¸‹å»ä¸€ä¸ªæ’åï¼Œä¸è®ºåœ¨ä½•å¤„éƒ½è¢«è¸©è‡³å°‘ä¸¤æ¬¡çš„å°±æ— ç¼˜ğŸ¥ˆã€‚è€Œä¸”å¯ä»¥è§‚å¯Ÿåˆ°ğŸ†çˆ·è¸©äººæ­£å¥½è¸©ä¸€ä¸ªåŒºé—´ï¼Œå¯è§ä¸‹å›¾ã€‚

<div style="width:70%;margin:auto"><img src="https://xyix.gitee.io/images/luogu-5328.jpg" alt=""></div>